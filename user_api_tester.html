<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User API Tester - PetMat</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        h1 {
            color: #667eea;
            margin-bottom: 10px;
        }
        .token-section {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .token-section input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        .token-status {
            margin-top: 10px;
            padding: 8px;
            border-radius: 4px;
            font-size: 14px;
        }
        .token-valid { background: #d4edda; color: #155724; }
        .token-invalid { background: #f8d7da; color: #721c24; }
        .section {
            margin-bottom: 30px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            overflow: hidden;
        }
        .section-header {
            background: #667eea;
            color: white;
            padding: 15px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            user-select: none;
        }
        .section-header:hover {
            background: #5568d3;
        }
        .section-content {
            padding: 20px;
            display: none;
        }
        .section-content.active {
            display: block;
        }
        .endpoint {
            background: #f8f9fa;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 6px;
            border-left: 4px solid #667eea;
        }
        .endpoint-title {
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }
        .method {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            margin-right: 10px;
        }
        .method-get { background: #28a745; color: white; }
        .method-post { background: #007bff; color: white; }
        .method-put { background: #ffc107; color: black; }
        .method-delete { background: #dc3545; color: white; }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #555;
        }
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        .form-group textarea {
            min-height: 80px;
            resize: vertical;
        }
        button {
            background: #667eea;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
        }
        button:hover {
            background: #5568d3;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .response {
            margin-top: 15px;
            padding: 15px;
            background: #f1f3f5;
            border-radius: 4px;
            border: 1px solid #dee2e6;
            max-height: 400px;
            overflow-y: auto;
        }
        .response pre {
            margin: 0;
            white-space: pre-wrap;
            word-wrap: break-word;
            font-size: 13px;
        }
        .response-success { border-left: 4px solid #28a745; }
        .response-error { border-left: 4px solid #dc3545; }
        .inline-inputs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üêæ User API Tester</h1>
        <p style="color: #666; margin-bottom: 20px;">Test all User Controller endpoints</p>

        <!-- Token Section -->
        <div class="token-section">
            <label style="font-weight: bold; margin-bottom: 10px; display: block;">Access Token:</label>
            <input type="text" id="accessToken" placeholder="Paste your access token here">
            <div id="tokenStatus" class="token-status" style="display: none;"></div>
        </div>

        <!-- Animal Management -->
        <div class="section">
            <div class="section-header" onclick="toggleSection(this)">üêï Animal Management</div>
            <div class="section-content">
                
                <!-- Get My Animals -->
                <div class="endpoint">
                    <div class="endpoint-title">
                        <span class="method method-get">GET</span>
                        Get My Animals
                    </div>
                    <button onclick="getMyAnimals()">Execute</button>
                    <div id="response-my-animals" class="response" style="display: none;"></div>
                </div>

                <!-- Add Animal -->
                <div class="endpoint">
                    <div class="endpoint-title">
                        <span class="method method-post">POST</span>
                        Add Animal
                    </div>
                    <div class="form-group">
                        <label>Pet Name:</label>
                        <input type="text" id="add-petname" placeholder="Fluffy">
                    </div>
                    <div class="inline-inputs">
                        <div class="form-group">
                            <label>Species ID:</label>
                            <input type="number" id="add-species" placeholder="1">
                        </div>
                        <div class="form-group">
                            <label>SubSpecies ID (Optional):</label>
                            <input type="number" id="add-subspecies">
                        </div>
                        <div class="form-group">
                            <label>Color ID (Optional):</label>
                            <input type="number" id="add-color">
                        </div>
                    </div>
                    <div class="inline-inputs">
                        <div class="form-group">
                            <label>Age:</label>
                            <input type="text" id="add-age" placeholder="2 years">
                        </div>
                        <div class="form-group">
                            <label>Size:</label>
                            <input type="text" id="add-size" placeholder="Medium">
                        </div>
                        <div class="form-group">
                            <label>Gender:</label>
                            <select id="add-gender">
                                <option value="Male">Male</option>
                                <option value="Female">Female</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Description:</label>
                        <textarea id="add-description" placeholder="Friendly and playful..."></textarea>
                    </div>
                    <div class="form-group">
                        <label>Image:</label>
                        <input type="file" id="add-image" accept="image/*">
                    </div>
                    <button onclick="addAnimal()">Add Animal</button>
                    <div id="response-add-animal" class="response" style="display: none;"></div>
                </div>

                <!-- Update Animal -->
                <div class="endpoint">
                    <div class="endpoint-title">
                        <span class="method method-put">PUT</span>
                        Update Animal
                    </div>
                    <div class="form-group">
                        <label>Animal ID:</label>
                        <input type="number" id="update-id" placeholder="1">
                    </div>
                    <div class="form-group">
                        <label>Pet Name:</label>
                        <input type="text" id="update-petname" placeholder="New name">
                    </div>
                    <div class="inline-inputs">
                        <div class="form-group">
                            <label>Age:</label>
                            <input type="text" id="update-age">
                        </div>
                        <div class="form-group">
                            <label>Size:</label>
                            <input type="text" id="update-size">
                        </div>
                    </div>
                    <button onclick="updateAnimal()">Update Animal</button>
                    <div id="response-update-animal" class="response" style="display: none;"></div>
                </div>

                <!-- Delete Animal -->
                <div class="endpoint">
                    <div class="endpoint-title">
                        <span class="method method-delete">DELETE</span>
                        Delete Animal
                    </div>
                    <div class="form-group">
                        <label>Animal ID:</label>
                        <input type="number" id="delete-animal-id" placeholder="1">
                    </div>
                    <button onclick="deleteAnimal()">Delete Animal</button>
                    <div id="response-delete-animal" class="response" style="display: none;"></div>
                </div>

            </div>
        </div>

        <!-- Animal Listings -->
        <div class="section">
            <div class="section-header" onclick="toggleSection(this)">üìã Animal Listings</div>
            <div class="section-content">
                
                <!-- Get All Listings -->
                <div class="endpoint">
                    <div class="endpoint-title">
                        <span class="method method-get">GET</span>
                        Get All Listings (Public)
                    </div>
                    <div class="inline-inputs">
                        <div class="form-group">
                            <label>Page Index:</label>
                            <input type="number" id="listings-page" value="1" min="1">
                        </div>
                        <div class="form-group">
                            <label>Page Size:</label>
                            <input type="number" id="listings-size" value="10" min="1">
                        </div>
                        <div class="form-group">
                            <label>Species ID (Optional):</label>
                            <input type="number" id="listings-species">
                        </div>
                    </div>
                    <div class="inline-inputs">
                        <div class="form-group">
                            <label>Type (Optional):</label>
                            <input type="text" id="listings-type" placeholder="Sale, Adoption">
                        </div>
                        <div class="form-group">
                            <label>Min Price:</label>
                            <input type="number" id="listings-minprice">
                        </div>
                        <div class="form-group">
                            <label>Max Price:</label>
                            <input type="number" id="listings-maxprice">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Search:</label>
                        <input type="text" id="listings-search" placeholder="Search term">
                    </div>
                    <button onclick="getAllListings()">Get Listings</button>
                    <div id="response-all-listings" class="response" style="display: none;"></div>
                </div>

                <!-- Get My Listings -->
                <div class="endpoint">
                    <div class="endpoint-title">
                        <span class="method method-get">GET</span>
                        Get My Listings
                    </div>
                    <button onclick="getMyListings()">Execute</button>
                    <div id="response-my-listings" class="response" style="display: none;"></div>
                </div>

                <!-- Add Listing -->
                <div class="endpoint">
                    <div class="endpoint-title">
                        <span class="method method-post">POST</span>
                        Add Animal Listing
                    </div>
                    <div class="form-group">
                        <label>Title:</label>
                        <input type="text" id="listing-title" placeholder="Beautiful Golden Retriever">
                    </div>
                    <div class="form-group">
                        <label>Description:</label>
                        <textarea id="listing-description" placeholder="Detailed description..."></textarea>
                    </div>
                    <div class="inline-inputs">
                        <div class="form-group">
                            <label>Price:</label>
                            <input type="number" id="listing-price" placeholder="500" step="0.01">
                        </div>
                        <div class="form-group">
                            <label>Type:</label>
                            <input type="text" id="listing-type" placeholder="Sale">
                        </div>
                        <div class="form-group">
                            <label>Animal ID:</label>
                            <input type="number" id="listing-animalid" placeholder="1">
                        </div>
                    </div>
                    <button onclick="addListing()">Create Listing</button>
                    <div id="response-add-listing" class="response" style="display: none;"></div>
                </div>

                <!-- Delete Listing -->
                <div class="endpoint">
                    <div class="endpoint-title">
                        <span class="method method-delete">DELETE</span>
                        Delete Listing
                    </div>
                    <div class="form-group">
                        <label>Listing ID:</label>
                        <input type="number" id="delete-listing-id" placeholder="1">
                    </div>
                    <button onclick="deleteListing()">Delete Listing</button>
                    <div id="response-delete-listing" class="response" style="display: none;"></div>
                </div>

            </div>
        </div>

        <!-- Species Info -->
        <div class="section">
            <div class="section-header" onclick="toggleSection(this)">ü¶Å Species Information (Public)</div>
            <div class="section-content">
                
                <!-- Get All Species -->
                <div class="endpoint">
                    <div class="endpoint-title">
                        <span class="method method-get">GET</span>
                        Get All Species
                    </div>
                    <button onclick="getAllSpecies()">Execute</button>
                    <div id="response-all-species" class="response" style="display: none;"></div>
                </div>

                <!-- Get All SubSpecies -->
                <div class="endpoint">
                    <div class="endpoint-title">
                        <span class="method method-get">GET</span>
                        Get All SubSpecies
                    </div>
                    <button onclick="getAllSubSpecies()">Execute</button>
                    <div id="response-all-subspecies" class="response" style="display: none;"></div>
                </div>

                <!-- Get SubSpecies by Species -->
                <div class="endpoint">
                    <div class="endpoint-title">
                        <span class="method method-get">GET</span>
                        Get SubSpecies by Species ID
                    </div>
                    <div class="form-group">
                        <label>Species ID:</label>
                        <input type="number" id="subspecies-speciesid" placeholder="1">
                    </div>
                    <button onclick="getSubSpeciesBySpecies()">Execute</button>
                    <div id="response-subspecies-by-species" class="response" style="display: none;"></div>
                </div>

                <!-- Get All Colors -->
                <div class="endpoint">
                    <div class="endpoint-title">
                        <span class="method method-get">GET</span>
                        Get All Colors
                    </div>
                    <button onclick="getAllColors()">Execute</button>
                    <div id="response-all-colors" class="response" style="display: none;"></div>
                </div>

            </div>
        </div>

    </div>

    <script>
        const API_BASE = 'http://localhost:5000/api';
        //const API_BASE = 'https://localhost:7289/api';

        // Token management
        const accessTokenInput = document.getElementById('accessToken');
        const tokenStatus = document.getElementById('tokenStatus');

        // Load token from localStorage on page load
        window.addEventListener('DOMContentLoaded', () => {
            const savedToken = localStorage.getItem('accessToken');
            if (savedToken) {
                accessTokenInput.value = savedToken;
                validateToken(savedToken);
            }
        });

        // Save token to localStorage when changed
        accessTokenInput.addEventListener('input', (e) => {
            const token = e.target.value.trim();
            if (token) {
                localStorage.setItem('accessToken', token);
                validateToken(token);
            } else {
                tokenStatus.style.display = 'none';
            }
        });

        function validateToken(token) {
            if (!token) {
                tokenStatus.style.display = 'none';
                return;
            }
            tokenStatus.style.display = 'block';
            try {
                const payload = JSON.parse(atob(token.split('.')[1]));
                const exp = payload.exp * 1000;
                const now = Date.now();
                if (exp > now) {
                    tokenStatus.className = 'token-status token-valid';
                    tokenStatus.textContent = `‚úì Token valid until ${new Date(exp).toLocaleString()}`;
                } else {
                    tokenStatus.className = 'token-status token-invalid';
                    tokenStatus.textContent = '‚úï Token expired';
                }
            } catch {
                tokenStatus.className = 'token-status token-invalid';
                tokenStatus.textContent = '‚úï Invalid token format';
            }
        }

        function getHeaders(includeAuth = true) {
            const headers = { 'Content-Type': 'application/json' };
            if (includeAuth) {
                const token = accessTokenInput.value.trim();
                if (token) headers['Authorization'] = `Bearer ${token}`;
            }
            return headers;
        }

        function showResponse(elementId, data, isError = false) {
            const el = document.getElementById(elementId);
            el.style.display = 'block';
            el.className = `response ${isError ? 'response-error' : 'response-success'}`;
            el.innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;
        }

        function toggleSection(header) {
            const content = header.nextElementSibling;
            content.classList.toggle('active');
        }

        // Animal Management
        async function getMyAnimals() {
            try {
                const response = await fetch(`${API_BASE}/User/my-animals`, {
                    headers: getHeaders()
                });
                const data = await response.json();
                showResponse('response-my-animals', data, !response.ok);
            } catch (error) {
                showResponse('response-my-animals', { error: error.message }, true);
            }
        }

        async function addAnimal() {
            const formData = new FormData();
            formData.append('PetName', document.getElementById('add-petname').value);
            formData.append('SpeciesId', document.getElementById('add-species').value);
            if (document.getElementById('add-subspecies').value) {
                formData.append('SubSpeciesId', document.getElementById('add-subspecies').value);
            }
            if (document.getElementById('add-color').value) {
                formData.append('ColorId', document.getElementById('add-color').value);
            }
            formData.append('Age', document.getElementById('add-age').value);
            formData.append('Size', document.getElementById('add-size').value);
            formData.append('Gender', document.getElementById('add-gender').value);
            formData.append('Description', document.getElementById('add-description').value);
            
            const imageFile = document.getElementById('add-image').files[0];
            if (imageFile) formData.append('Image', imageFile);

            try {
                const token = accessTokenInput.value.trim();
                const response = await fetch(`${API_BASE}/User/animal`, {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${token}` },
                    body: formData
                });
                const data = await response.json();
                showResponse('response-add-animal', data, !response.ok);
            } catch (error) {
                showResponse('response-add-animal', { error: error.message }, true);
            }
        }

        async function updateAnimal() {
            const id = document.getElementById('update-id').value;
            const formData = new FormData();
            if (document.getElementById('update-petname').value) {
                formData.append('PetName', document.getElementById('update-petname').value);
            }
            if (document.getElementById('update-age').value) {
                formData.append('Age', document.getElementById('update-age').value);
            }
            if (document.getElementById('update-size').value) {
                formData.append('Size', document.getElementById('update-size').value);
            }

            try {
                const token = accessTokenInput.value.trim();
                const response = await fetch(`${API_BASE}/User/animal/${id}`, {
                    method: 'PUT',
                    headers: { 'Authorization': `Bearer ${token}` },
                    body: formData
                });
                const data = await response.json();
                showResponse('response-update-animal', data, !response.ok);
            } catch (error) {
                showResponse('response-update-animal', { error: error.message }, true);
            }
        }

        async function deleteAnimal() {
            const id = document.getElementById('delete-animal-id').value;
            try {
                const response = await fetch(`${API_BASE}/User/animal/${id}`, {
                    method: 'DELETE',
                    headers: getHeaders()
                });
                const data = await response.json();
                showResponse('response-delete-animal', data, !response.ok);
            } catch (error) {
                showResponse('response-delete-animal', { error: error.message }, true);
            }
        }

        // Listings
        async function getAllListings() {
            const params = new URLSearchParams();
            params.append('PageIndex', document.getElementById('listings-page').value);
            params.append('PageSize', document.getElementById('listings-size').value);
            if (document.getElementById('listings-species').value) {
                params.append('SpeciesId', document.getElementById('listings-species').value);
            }
            if (document.getElementById('listings-type').value) {
                params.append('Type', document.getElementById('listings-type').value);
            }
            if (document.getElementById('listings-minprice').value) {
                params.append('MinPrice', document.getElementById('listings-minprice').value);
            }
            if (document.getElementById('listings-maxprice').value) {
                params.append('MaxPrice', document.getElementById('listings-maxprice').value);
            }
            if (document.getElementById('listings-search').value) {
                params.append('Search', document.getElementById('listings-search').value);
            }

            try {
                const response = await fetch(`${API_BASE}/User/listings?${params}`, {
                    headers: getHeaders(false)
                });
                const data = await response.json();
                showResponse('response-all-listings', data, !response.ok);
            } catch (error) {
                showResponse('response-all-listings', { error: error.message }, true);
            }
        }

        async function getMyListings() {
            try {
                const response = await fetch(`${API_BASE}/User/my-listings`, {
                    headers: getHeaders()
                });
                const data = await response.json();
                showResponse('response-my-listings', data, !response.ok);
            } catch (error) {
                showResponse('response-my-listings', { error: error.message }, true);
            }
        }

        async function addListing() {
            const body = {
                Title: document.getElementById('listing-title').value,
                Description: document.getElementById('listing-description').value,
                Price: parseFloat(document.getElementById('listing-price').value),
                Type: document.getElementById('listing-type').value,
                AnimalId: parseInt(document.getElementById('listing-animalid').value)
            };

            try {
                const response = await fetch(`${API_BASE}/User/listing`, {
                    method: 'POST',
                    headers: getHeaders(),
                    body: JSON.stringify(body)
                });
                const data = await response.json();
                showResponse('response-add-listing', data, !response.ok);
            } catch (error) {
                showResponse('response-add-listing', { error: error.message }, true);
            }
        }

        async function deleteListing() {
            const id = document.getElementById('delete-listing-id').value;
            try {
                const response = await fetch(`${API_BASE}/User/listing/${id}`, {
                    method: 'DELETE',
                    headers: getHeaders()
                });
                const data = await response.json();
                showResponse('response-delete-listing', data, !response.ok);
            } catch (error) {
                showResponse('response-delete-listing', { error: error.message }, true);
            }
        }

        // Species Info
        async function getAllSpecies() {
            try {
                const response = await fetch(`${API_BASE}/User/species`, {
                    headers: getHeaders(false)
                });
                const data = await response.json();
                showResponse('response-all-species', data, !response.ok);
            } catch (error) {
                showResponse('response-all-species', { error: error.message }, true);
            }
        }

        async function getAllSubSpecies() {
            try {
                const response = await fetch(`${API_BASE}/User/subspecies`, {
                    headers: getHeaders(false)
                });
                const data = await response.json();
                showResponse('response-all-subspecies', data, !response.ok);
            } catch (error) {
                showResponse('response-all-subspecies', { error: error.message }, true);
            }
        }

        async function getSubSpeciesBySpecies() {
            const speciesId = document.getElementById('subspecies-speciesid').value;
            try {
                const response = await fetch(`${API_BASE}/User/subspecies/species/${speciesId}`, {
                    headers: getHeaders(false)
                });
                const data = await response.json();
                showResponse('response-subspecies-by-species', data, !response.ok);
            } catch (error) {
                showResponse('response-subspecies-by-species', { error: error.message }, true);
            }
        }

        async function getAllColors() {
            try {
                const response = await fetch(`${API_BASE}/User/colors`, {
                    headers: getHeaders(false)
                });
                const data = await response.json();
                showResponse('response-all-colors', data, !response.ok);
            } catch (error) {
                showResponse('response-all-colors', { error: error.message }, true);
            }
        }
    </script>
</body>
</html>