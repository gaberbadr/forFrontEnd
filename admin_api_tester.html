<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin API Tester - PetMat</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        h1 {
            color: #f5576c;
            margin-bottom: 10px;
        }
        .admin-badge {
            display: inline-block;
            background: #f5576c;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            margin-bottom: 20px;
        }
        .token-section {
            background: #fff5f7;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 2px solid #f5576c;
        }
        .token-section input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        .token-status {
            margin-top: 10px;
            padding: 8px;
            border-radius: 4px;
            font-size: 14px;
        }
        .token-valid { background: #d4edda; color: #155724; }
        .token-invalid { background: #f8d7da; color: #721c24; }
        .section {
            margin-bottom: 30px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            overflow: hidden;
        }
        .section-header {
            background: #f5576c;
            color: white;
            padding: 15px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            user-select: none;
        }
        .section-header:hover {
            background: #d94557;
        }
        .section-content {
            padding: 20px;
            display: none;
        }
        .section-content.active {
            display: block;
        }
        .endpoint {
            background: #fff5f7;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 6px;
            border-left: 4px solid #f5576c;
        }
        .endpoint-title {
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }
        .method {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            margin-right: 10px;
        }
        .method-get { background: #28a745; color: white; }
        .method-post { background: #007bff; color: white; }
        .method-delete { background: #dc3545; color: white; }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #555;
        }
        .form-group input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        button {
            background: #f5576c;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
        }
        button:hover {
            background: #d94557;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .response {
            margin-top: 15px;
            padding: 15px;
            background: #f1f3f5;
            border-radius: 4px;
            border: 1px solid #dee2e6;
            max-height: 400px;
            overflow-y: auto;
        }
        .response pre {
            margin: 0;
            white-space: pre-wrap;
            word-wrap: break-word;
            font-size: 13px;
        }
        .response-success { border-left: 4px solid #28a745; }
        .response-error { border-left: 4px solid #dc3545; }
        .warning {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 12px;
            border-radius: 4px;
            margin-bottom: 20px;
            color: #856404;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üëë Admin API Tester</h1>
        <span class="admin-badge">ADMIN ONLY</span>
        <p style="color: #666; margin-bottom: 20px;">Test all Admin Controller endpoints</p>

        <div class="warning">
            ‚ö†Ô∏è <strong>Warning:</strong> These endpoints require Admin role. Make sure you're using an admin access token.
        </div>

        <!-- Token Section -->
        <div class="token-section">
            <label style="font-weight: bold; margin-bottom: 10px; display: block;">Admin Access Token:</label>
            <input type="text" id="accessToken" placeholder="Paste your admin access token here">
            <div id="tokenStatus" class="token-status" style="display: none;"></div>
        </div>

        <!-- User Management -->
        <div class="section">
            <div class="section-header" onclick="toggleSection(this)">üë§ User Management</div>
            <div class="section-content">
                
                <!-- Block User -->
                <div class="endpoint">
                    <div class="endpoint-title">
                        <span class="method method-post">POST</span>
                        Block User
                    </div>
                    <div class="form-group">
                        <label>User ID:</label>
                        <input type="text" id="block-userid" placeholder="Enter user ID to block">
                    </div>
                    <button onclick="blockUser()">Block User</button>
                    <div id="response-block-user" class="response" style="display: none;"></div>
                </div>

                <!-- Unblock User -->
                <div class="endpoint">
                    <div class="endpoint-title">
                        <span class="method method-post">POST</span>
                        Unblock User
                    </div>
                    <div class="form-group">
                        <label>User ID:</label>
                        <input type="text" id="unblock-userid" placeholder="Enter user ID to unblock">
                    </div>
                    <button onclick="unblockUser()">Unblock User</button>
                    <div id="response-unblock-user" class="response" style="display: none;"></div>
                </div>

            </div>
        </div>

        <!-- Species Management -->
        <div class="section">
            <div class="section-header" onclick="toggleSection(this)">ü¶Å Species Management</div>
            <div class="section-content">
                
                <!-- Add Species -->
                <div class="endpoint">
                    <div class="endpoint-title">
                        <span class="method method-post">POST</span>
                        Add Species
                    </div>
                    <div class="form-group">
                        <label>Species Name:</label>
                        <input type="text" id="add-species-name" placeholder="e.g., Dog, Cat, Bird">
                    </div>
                    <button onclick="addSpecies()">Add Species</button>
                    <div id="response-add-species" class="response" style="display: none;"></div>
                </div>

                <!-- Delete Species -->
                <div class="endpoint">
                    <div class="endpoint-title">
                        <span class="method method-delete">DELETE</span>
                        Delete Species
                    </div>
                    <div class="form-group">
                        <label>Species ID:</label>
                        <input type="number" id="delete-species-id" placeholder="Enter species ID">
                    </div>
                    <button onclick="deleteSpecies()">Delete Species</button>
                    <div id="response-delete-species" class="response" style="display: none;"></div>
                </div>

            </div>
        </div>

        <!-- SubSpecies Management -->
        <div class="section">
            <div class="section-header" onclick="toggleSection(this)">üêï SubSpecies Management</div>
            <div class="section-content">
                
                <!-- Add SubSpecies -->
                <div class="endpoint">
                    <div class="endpoint-title">
                        <span class="method method-post">POST</span>
                        Add SubSpecies
                    </div>
                    <div class="form-group">
                        <label>SubSpecies Name:</label>
                        <input type="text" id="add-subspecies-name" placeholder="e.g., Golden Retriever, Persian">
                    </div>
                    <div class="form-group">
                        <label>Species ID:</label>
                        <input type="number" id="add-subspecies-speciesid" placeholder="Parent species ID">
                    </div>
                    <button onclick="addSubSpecies()">Add SubSpecies</button>
                    <div id="response-add-subspecies" class="response" style="display: none;"></div>
                </div>

                <!-- Delete SubSpecies -->
                <div class="endpoint">
                    <div class="endpoint-title">
                        <span class="method method-delete">DELETE</span>
                        Delete SubSpecies
                    </div>
                    <div class="form-group">
                        <label>SubSpecies ID:</label>
                        <input type="number" id="delete-subspecies-id" placeholder="Enter subspecies ID">
                    </div>
                    <button onclick="deleteSubSpecies()">Delete SubSpecies</button>
                    <div id="response-delete-subspecies" class="response" style="display: none;"></div>
                </div>

            </div>
        </div>

        <!-- Color Management -->
        <div class="section">
            <div class="section-header" onclick="toggleSection(this)">üé® Color Management</div>
            <div class="section-content">
                
                <!-- Add Color -->
                <div class="endpoint">
                    <div class="endpoint-title">
                        <span class="method method-post">POST</span>
                        Add Color
                    </div>
                    <div class="form-group">
                        <label>Color Name:</label>
                        <input type="text" id="add-color-name" placeholder="e.g., Brown, Black, White">
                    </div>
                    <button onclick="addColor()">Add Color</button>
                    <div id="response-add-color" class="response" style="display: none;"></div>
                </div>

                <!-- Delete Color -->
                <div class="endpoint">
                    <div class="endpoint-title">
                        <span class="method method-delete">DELETE</span>
                        Delete Color
                    </div>
                    <div class="form-group">
                        <label>Color ID:</label>
                        <input type="number" id="delete-color-id" placeholder="Enter color ID">
                    </div>
                    <button onclick="deleteColor()">Delete Color</button>
                    <div id="response-delete-color" class="response" style="display: none;"></div>
                </div>

            </div>
        </div>

    </div>

    <script>

        const API_BASE = 'http://localhost:5000/api';
        //const API_BASE = 'https://localhost:7289/api';

        // Token management
        const accessTokenInput = document.getElementById('accessToken');
        const tokenStatus = document.getElementById('tokenStatus');

        // Load token from localStorage on page load
        window.addEventListener('DOMContentLoaded', () => {
            const savedToken = localStorage.getItem('accessToken');
            if (savedToken) {
                accessTokenInput.value = savedToken;
                validateToken(savedToken);
            }
        });

        // Save token to localStorage when changed
        accessTokenInput.addEventListener('input', (e) => {
            const token = e.target.value.trim();
            if (token) {
                localStorage.setItem('accessToken', token);
                validateToken(token);
            } else {
                tokenStatus.style.display = 'none';
            }
        });

        function validateToken(token) {
            if (!token) {
                tokenStatus.style.display = 'none';
                return;
            }
            tokenStatus.style.display = 'block';
            try {
                const payload = JSON.parse(atob(token.split('.')[1]));
                const exp = payload.exp * 1000;
                const now = Date.now();
                
                // Check for admin role
                const roles = payload.role || payload['http://schemas.microsoft.com/ws/2008/06/identity/claims/role'];
                const isAdmin = Array.isArray(roles) ? roles.includes('Admin') : roles === 'Admin';
                
                if (exp > now) {
                    if (isAdmin) {
                        tokenStatus.className = 'token-status token-valid';
                        tokenStatus.textContent = `‚úì Admin token valid until ${new Date(exp).toLocaleString()}`;
                    } else {
                        tokenStatus.className = 'token-status token-invalid';
                        tokenStatus.textContent = '‚ö†Ô∏è Token valid but does not have Admin role';
                    }
                } else {
                    tokenStatus.className = 'token-status token-invalid';
                    tokenStatus.textContent = '‚úï Token expired';
                }
            } catch {
                tokenStatus.className = 'token-status token-invalid';
                tokenStatus.textContent = '‚úï Invalid token format';
            }
        }

        function getHeaders() {
            const token = accessTokenInput.value.trim();
            return {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${token}`
            };
        }

        function showResponse(elementId, data, isError = false) {
            const el = document.getElementById(elementId);
            el.style.display = 'block';
            el.className = `response ${isError ? 'response-error' : 'response-success'}`;
            el.innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;
        }

        function toggleSection(header) {
            const content = header.nextElementSibling;
            content.classList.toggle('active');
        }

        // User Management
        async function blockUser() {
            const userId = document.getElementById('block-userid').value.trim();
            if (!userId) {
                alert('Please enter a user ID');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/Admin/block-user/${userId}`, {
                    method: 'POST',
                    headers: getHeaders()
                });
                const data = await response.json();
                showResponse('response-block-user', data, !response.ok);
            } catch (error) {
                showResponse('response-block-user', { error: error.message }, true);
            }
        }

        async function unblockUser() {
            const userId = document.getElementById('unblock-userid').value.trim();
            if (!userId) {
                alert('Please enter a user ID');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/Admin/unblock-user/${userId}`, {
                    method: 'POST',
                    headers: getHeaders()
                });
                const data = await response.json();
                showResponse('response-unblock-user', data, !response.ok);
            } catch (error) {
                showResponse('response-unblock-user', { error: error.message }, true);
            }
        }

        // Species Management
        async function addSpecies() {
            const name = document.getElementById('add-species-name').value.trim();
            if (!name) {
                alert('Please enter a species name');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/Admin/species`, {
                    method: 'POST',
                    headers: getHeaders(),
                    body: JSON.stringify({ Name: name })
                });
                const data = await response.json();
                showResponse('response-add-species', data, !response.ok);
            } catch (error) {
                showResponse('response-add-species', { error: error.message }, true);
            }
        }

        async function deleteSpecies() {
            const id = document.getElementById('delete-species-id').value;
            if (!id) {
                alert('Please enter a species ID');
                return;
            }

            if (!confirm(`Are you sure you want to delete species with ID ${id}?`)) {
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/Admin/species/${id}`, {
                    method: 'DELETE',
                    headers: getHeaders()
                });
                const data = await response.json();
                showResponse('response-delete-species', data, !response.ok);
            } catch (error) {
                showResponse('response-delete-species', { error: error.message }, true);
            }
        }

        // SubSpecies Management
        async function addSubSpecies() {
            const name = document.getElementById('add-subspecies-name').value.trim();
            const speciesId = document.getElementById('add-subspecies-speciesid').value;
            
            if (!name || !speciesId) {
                alert('Please enter both subspecies name and species ID');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/Admin/subspecies`, {
                    method: 'POST',
                    headers: getHeaders(),
                    body: JSON.stringify({ 
                        Name: name,
                        SpeciesId: parseInt(speciesId)
                    })
                });
                const data = await response.json();
                showResponse('response-add-subspecies', data, !response.ok);
            } catch (error) {
                showResponse('response-add-subspecies', { error: error.message }, true);
            }
        }

        async function deleteSubSpecies() {
            const id = document.getElementById('delete-subspecies-id').value;
            if (!id) {
                alert('Please enter a subspecies ID');
                return;
            }

            if (!confirm(`Are you sure you want to delete subspecies with ID ${id}?`)) {
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/Admin/subspecies/${id}`, {
                    method: 'DELETE',
                    headers: getHeaders()
                });
                const data = await response.json();
                showResponse('response-delete-subspecies', data, !response.ok);
            } catch (error) {
                showResponse('response-delete-subspecies', { error: error.message }, true);
            }
        }

        // Color Management
        async function addColor() {
            const name = document.getElementById('add-color-name').value.trim();
            if (!name) {
                alert('Please enter a color name');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/Admin/color`, {
                    method: 'POST',
                    headers: getHeaders(),
                    body: JSON.stringify({ Name: name })
                });
                const data = await response.json();
                showResponse('response-add-color', data, !response.ok);
            } catch (error) {
                showResponse('response-add-color', { error: error.message }, true);
            }
        }

        async function deleteColor() {
            const id = document.getElementById('delete-color-id').value;
            if (!id) {
                alert('Please enter a color ID');
                return;
            }

            if (!confirm(`Are you sure you want to delete color with ID ${id}?`)) {
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/Admin/color/${id}`, {
                    method: 'DELETE',
                    headers: getHeaders()
                });
                const data = await response.json();
                showResponse('response-delete-color', data, !response.ok);
            } catch (error) {
                showResponse('response-delete-color', { error: error.message }, true);
            }
        }
    </script>
</body>
</html>